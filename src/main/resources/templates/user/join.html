<!DOCTYPE html>
<html lang="en"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorator="~{layouts/layout}">

<th:block layout:fragment="css">
<style>
</style>
</th:block>

<th:block layout:fragment="script">
  <script>
    jQuery(document).ready(function() {

    });

    let id_flag = false;
    let pwd_flag = false;
    let cheked_id = '';
    let cheked_pwd = '';

    function checkID() {
      $.ajax({
        url: "/checkID",
        type: "POST",
        data: $("#usr_id").val(),
        success: function (data) {
          if (data.result == true) {
            alert("사용 가능한 아이디입니다.");
            $("#usr_id").disabled = true;
            $("#usr_pwd").focus();

            id_flag = true;
            let cheked_id = '';
          } else {
            alert(data.errorMsg);
            // $("#usr_id").addClass("has-error")
            // $("#usr_id").removeClass("has-success")
            $("#usr_id").focus();

          }
        },
        error: function (error) {
          if (this.data == null) {
            alert("아이디를 입력하지 않았습니다.");
          }
          alert("error : " + error);
        }
      });
    }

    function checkPW() {
      $.ajax({
        url: "/checkPW",
        type: "POST",
        data: {usr_pwd:$("#usr_pwd").val(), confirm_pwd:$("#confirm_pwd").val()},
        success: function (data) {
          if (data.result == true) {
            pwd_flag = true;
            alert("비밀번호 확인이 완료되었습니다.");
          }

          alert(data.errorMsg);
          $("#usr_pwd").focus();

        }
      });

    }

      function checkInput() {
      var name = $("#name").val();
      var svc_id = $("#svc_id").val();
      var usr_id = $("#usr_id").val();
      var usr_pwd = $("#usr_pwd").val();
      var email = $("#email").val();
      var tel = $("#tel").val();

      if (name.length < 1) {
        alert("이름을 입력했는지 확인하세요.");
        return;
      }

      if (svc_id.length < 1) {
        alert("기업 아이디를 입력했는지 확인하세요.");
        return;
      }

      if (usr_id.length < 1) {
        alert("아이디를 입력했는지 확인하세요.");
        return;
      }

      if (usr_pwd.length < 1 || confirm_pwd.length < 1){
        alert("비밀번호를 입력했는지 확인하세요.");
        return;
      }

      if (email.length < 1) {
        alert("이메일을 입력했는지 확인하세요.");
        return;
      }

      if (tel.length < 1){
        alert("전화번호를 입력했는지 확인하세요.");
        return;
      }

      if (!id_flag || usr_id != cheked_id) {
        alert("아이디를 확인하세요.");
      }

      if (!pwd_flag) {
        alert("비밀번호를 확인하세요.");
      }

      $('#joinForm').submit();
    }

  </script>
</th:block>

<div layout:fragment="content">
  <div id="user_join">
    <form id="joinForm" th:action="@{join}" method='post'>
      <div style="text-align: center; padding: 50px 0px;">
        <p class="title" >마켓 꼬리 배송관리 시스템 회원가입</p>

        <div class="w-50 center" style="font-size: 12px;">

          <div class="mb-3 row">
            <label for="name" class='form-label col-sm-2 col-form-label'>이름</label>
            <div class="col-sm-7">
              <input id="name" th:field="${user.name}" type='text' class="form-control" placeholder="Name">
            </div>
          </div>

          <div class="mb-3 row">
            <label for="svc_id" class='form-label col-sm-2 col-form-label'>기업 아이디</label>
            <div class="col-sm-7">
              <input id="svc_id" th:field="${user.svc_id}" type='text' class="form-control" placeholder="기업 ID" >
            </div>
          </div>

          <div class="mb-3 row">
            <label for="usr_id" class='form-label col-sm-2 col-form-label'>로그인 아이디</label>
            <div class="col-sm-7">
              <div class="input-group mb-3">
                <input id="usr_id" th:field="${user.usr_id}" type='text' class="form-control" placeholder="로그인 ID">
                <button id="btn_checkID" type="button" class="btn btn-secondary btn-lg" onclick="checkID();">아이디 확인</button>
              </div>
            </div>
          </div>

          <div class="mb-3 row">
            <label for="usr_pwd" class='form-label col-sm-2 col-form-label'>비밀번호</label>
            <div class="col-sm-7">
              <input id="usr_pwd" th:field="${user.usr_pwd}" type='password' class="form-control"
                     placeholder="숫자, 문자, 특수문자(!@#$%^&*()?_~)로 이루어진 8 ~ 20자리의 문자열">

            </div>
          </div>

          <div class="mb-3 row">
            <label for="confirm_pwd" class='form-label col-sm-2 col-form-label'>비밀번호 확인</label>
            <div class="col-sm-7">
              <div class="input-group mb-3">
                <input id="confirm_pwd" type='password' class="form-control"
                       placeholder="위와 동일한 비밀번호 입력">
                <button id="btn_checkPW" type="button" class="btn btn-secondary btn-lg" onclick="checkPW();">비밀번호 확인</button>
              </div>
            </div>
          </div>

          <div class="mb-3 row">
            <label for="email" class='form-label col-sm-2 col-form-label'>이메일</label>
            <div class="col-sm-7">
              <input id="email" th:field="${user.email}" type='email' class="form-control" placeholder="Email Address (eg. ggori@test.com)">
            </div>
          </div>

          <div class="mb-3 row">
            <label for="tel" class='form-label col-sm-2 col-form-label'>전화번호</label>
            <div class="col-sm-7">
              <input id="tel" th:field="${user.tel}" type='tel' class="form-control" placeholder="Telephone No">
            </div>
          </div>
        </div>

        <input style="display: none;" type='text' class="form-control" name='admin_yn' value="n">
        <input style="display: none;" type='text' class="form-control" name='use_yn' value="y">
        <input style="display: none;" type='text' class="form-control" name='block_yn' value="n">

        <div style="margin-top:10px; margin-bottom: 10px;">
          <button id="btn_join" type="button" class="btn btn-primary btn-lg" onclick="checkInput();">회원 가입</button>
          <a href="/user/main" class="btn btn-secondary btn-lg">취소</a>
        </div>
      </div>
    </form>
  </div>

</div>
</html>